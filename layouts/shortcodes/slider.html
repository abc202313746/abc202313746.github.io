{{ $raw := .Get "items" }}
{{ $list := split $raw ";" }}
{{ $height := .Get "height" | default "320" }}
{{ $autoplay := .Get "autoplay" | default "true" }}
{{ $interval := .Get "interval" | default "3500" }}

<div class="cc-slider" data-autoplay="{{ $autoplay }}" data-interval="{{ $interval }}" style="position:relative;min-height: {{ $height }}px;">
  <div class="cc-slider__track" style="display:flex;gap:12px;overflow-x:auto;white-space:nowrap;padding:8px;scroll-snap-type:x mandatory;scrollbar-width:none;">
    {{- range $list -}}
      {{- $entry := . | trim " " -}}
      {{- if gt (len $entry) 0 -}}
        {{- $parts := split $entry "|" -}}
        <figure style="min-width:80%;margin:0;position:relative;scroll-snap-align:start;border-radius:12px;overflow:hidden;">
          <img src="{{ index $parts 0 }}" alt="{{ if ge (len $parts) 2 }}{{ index $parts 1 }}{{ end }}" style="width:100%;height:{{ $height }}px;object-fit:cover;display:block;" loading="lazy" />
          {{ if ge (len $parts) 3 }}
            <figcaption style="position:absolute;left:0;right:0;bottom:0;color:#fff;background:linear-gradient(transparent, rgba(0,0,0,.6));padding:12px 16px;">{{ index $parts 2 }}</figcaption>
          {{ end }}
        </figure>
      {{- end -}}
    {{- end -}}
  </div>
  <div class="cc-slider__dots" style="display:flex;gap:8px;justify-content:center;margin:8px 0 0 0;"></div>
  <noscript>
    <div style="display:grid;grid-template-columns:repeat(auto-fill,minmax(220px,1fr));gap:12px;">
      {{- range $list -}}
        {{- $entry := . | trim " " -}}
        {{- if gt (len $entry) 0 -}}
          {{- $parts := split $entry "|" -}}
          <figure style="margin:0;border-radius:12px;overflow:hidden;">
            <img src="{{ index $parts 0 }}" alt="{{ if ge (len $parts) 2 }}{{ index $parts 1 }}{{ end }}" style="width:100%;height:{{ $height }}px;object-fit:cover;display:block;" />
            {{ if ge (len $parts) 3 }}
              <figcaption style="padding:8px 0;opacity:.8;">{{ index $parts 2 }}</figcaption>
            {{ end }}
          </figure>
        {{- end -}}
      {{- end -}}
    </div>
  </noscript>
</div>

<style>
  .cc-slider__track::-webkit-scrollbar { display:none; }
  .cc-slider__dot { width:28px;height:4px;border-radius:2px;background:#c7c7c7;opacity:.6;transition:opacity .2s,background-color .2s }
  .cc-slider__dot[aria-current="true"] { background: var(--bs-primary, #7C4DFF); opacity:1 }
</style>
<script>
  (function(){
    function init(el){
      if (el.dataset.enhanced) return; el.dataset.enhanced = '1';
      const track = el.querySelector('.cc-slider__track');
      const figs = Array.from(track.querySelectorAll('figure'));
      const dotsWrap = el.querySelector('.cc-slider__dots');
      if (!figs.length) return;
      dotsWrap.innerHTML = '';
      figs.forEach((_,i)=>{
        const dot = document.createElement('button');
        dot.type = 'button';
        dot.className = 'cc-slider__dot';
        dot.setAttribute('aria-label','Go to slide '+(i+1));
        dot.addEventListener('click',()=>{
          const target = figs[i];
          track.scrollTo({ left: target.offsetLeft - track.offsetLeft, behavior:'smooth' });
        });
        dotsWrap.appendChild(dot);
      });
      const setActive = ()=>{
        const idx = Math.round(track.scrollLeft / (track.scrollWidth / figs.length));
        Array.from(dotsWrap.children).forEach((d,j)=>d.setAttribute('aria-current', j===idx ? 'true':'false'));
      };
      track.addEventListener('scroll', ()=>{ window.requestAnimationFrame(setActive); });
      setActive();
      // autoplay
      if (el.dataset.autoplay === 'true'){
        let i=0; let timer;
        const interval = parseInt(el.dataset.interval||'3500',10);
        const play=()=>{ timer = setInterval(()=>{
          i = (i+1)%figs.length; const t = figs[i];
          track.scrollTo({ left: t.offsetLeft - track.offsetLeft, behavior:'smooth' });
        }, interval); };
        const pause=()=>{ if (timer) clearInterval(timer); };
        el.addEventListener('mouseenter', pause);
        el.addEventListener('mouseleave', ()=>{ play(); });
        play();
      }
    }
    function onReady(){ document.querySelectorAll('.cc-slider').forEach(init); }
    if (document.readyState === 'loading') document.addEventListener('DOMContentLoaded', onReady); else onReady();
  })();
</script>