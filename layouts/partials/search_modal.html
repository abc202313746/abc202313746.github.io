{{/* Search Modal Overlay */}}
<div id="search-modal" class="search-modal" style="display:none;position:fixed;top:0;left:0;width:100%;height:100%;background:rgba(0,0,0,0.8);z-index:9999;padding:20px;box-sizing:border-box;">
  <div class="search-modal-content" style="max-width:800px;margin:50px auto;background:#2d3748;border-radius:8px;padding:32px;position:relative;">
    <button id="search-modal-close" style="position:absolute;top:16px;right:16px;background:none;border:none;font-size:28px;cursor:pointer;color:#a0aec0;width:40px;height:40px;display:flex;align-items:center;justify-content:center;border-radius:50%;transition:all 0.2s;" onmouseover="this.style.background='rgba(255,255,255,0.1);this.style.color='#fff'" onmouseout="this.style.background='none';this.style.color='#a0aec0'">×</button>
    
    <h3 style="margin-top:0;margin-bottom:24px;font-size:1.75rem;color:#fff;font-weight:600;">{{ i18n "search" | default "검색" }}</h3>
    
    <div id="search-container">
      <input 
        id="search-modal-input" 
        type="search" 
        placeholder="{{ i18n "search_placeholder" | default "검색..." }}" 
        style="width:100%;padding:14px 20px;border:1px solid #4a5568;border-radius:6px;font-size:16px;outline:none;transition:all 0.2s;background:#1a202c;color:#fff;"
        onfocus="this.style.borderColor='#63b3ed';this.style.boxShadow='0 0 0 3px rgba(99,179,237,0.1)'"
        onblur="this.style.borderColor='#4a5568';this.style.boxShadow='none'"
      >
      <div id="search-modal-results" style="margin-top:20px;max-height:400px;overflow-y:auto;"></div>
    </div>
  </div>
</div>

<script>
(function(){
  let searchModal = null;
  let searchInput = null;
  let searchResults = null;
  let pagefindUI = null;
  
  function initSearchModal() {
    searchModal = document.getElementById('search-modal');
    searchInput = document.getElementById('search-modal-input');
    searchResults = document.getElementById('search-modal-results');
    
    if (!searchModal) return;
    
    // Close modal handlers
    document.getElementById('search-modal-close').addEventListener('click', closeModal);
    searchModal.addEventListener('click', function(e) {
      if (e.target === searchModal) closeModal();
    });
    
    // ESC key to close
    document.addEventListener('keydown', function(e) {
      if (e.key === 'Escape' && searchModal.style.display !== 'none') {
        closeModal();
      }
    });
    
    // Focus search input when modal opens
    searchInput.addEventListener('focus', function() {
      if (!pagefindUI) {
        loadPagefindUI();
      }
    });
    
    // Search icon click handler
    document.addEventListener('click', function(e) {
      const searchBtn = e.target.closest('[data-search-toggle], .search-btn, .navbar-nav .nav-link[href*="search"]');
      if (searchBtn) {
        e.preventDefault();
        openModal();
      }
    });
  }
  
  function openModal() {
    if (searchModal) {
      searchModal.style.display = 'block';
      document.body.style.overflow = 'hidden';
      setTimeout(() => searchInput.focus(), 100);
    }
  }
  
  function closeModal() {
    if (searchModal) {
      searchModal.style.display = 'none';
      document.body.style.overflow = '';
      searchInput.value = '';
      searchResults.innerHTML = '';
    }
  }
  
  function loadPagefindUI() {
    if (pagefindUI) return;
    
    const script = document.createElement('script');
    script.src = '/pagefind/pagefind-ui.js';
    script.onload = function() {
      if (window.PagefindUI) {
        pagefindUI = new window.PagefindUI({
          element: '#search-modal-results',
          showSubResults: false,
          showImages: false,
          excerptLength: 30,
          autofocus: false,
          resetStyles: true,
          showEmptyFilters: false,
          translations: {
            placeholder: '{{ i18n "search_placeholder" | default "검색어를 입력하세요..." }}'
          }
        });
        
        // Sync external input with Pagefind UI
        searchInput.addEventListener('input', function(e) {
          const query = e.target.value;
          const pagefindInput = searchResults.querySelector('input[type="search"]');
          if (pagefindInput) {
            pagefindInput.value = query;
            pagefindInput.dispatchEvent(new Event('input'));
          }
        });
      }
    };
    document.head.appendChild(script);
    
    const link = document.createElement('link');
    link.rel = 'stylesheet';
    link.href = '/pagefind/pagefind-ui.css';
    document.head.appendChild(link);
  }
  
  // Initialize when DOM is ready
  if (document.readyState === 'loading') {
    document.addEventListener('DOMContentLoaded', initSearchModal);
  } else {
    initSearchModal();
  }
})();
</script>

<style>
.search-modal input[type="search"]::placeholder {
  color: #718096;
}

.search-modal .pagefind-ui__search-input {
  display: none !important;
}

.search-modal .pagefind-ui__results {
  margin-top: 0 !important;
}

.search-modal .pagefind-ui__result {
  background: #1a202c;
  border: 1px solid #4a5568;
  border-radius: 6px;
  margin-bottom: 12px;
  padding: 16px;
  transition: all 0.2s;
}

.search-modal .pagefind-ui__result:hover {
  background: #2d3748;
  border-color: #63b3ed;
}

.search-modal .pagefind-ui__result-title {
  font-weight: 600;
  color: #63b3ed;
  margin-bottom: 8px;
  font-size: 1.1rem;
}

.search-modal .pagefind-ui__result-excerpt {
  color: #a0aec0;
  line-height: 1.5;
  font-size: 0.9rem;
}

.search-modal .pagefind-ui__result-link {
  color: #63b3ed;
  text-decoration: none;
}

.search-modal .pagefind-ui__result-link:hover {
  color: #90cdf4;
}

/* Hide any suggestion or autocomplete elements */
.search-modal .pagefind-ui__drawer,
.search-modal .pagefind-ui__suggestions,
.search-modal .pagefind-ui__filter-panel {
  display: none !important;
}

/* Hide filters and other UI elements */
.search-modal .pagefind-ui__filters,
.search-modal .pagefind-ui__sort-select,
.search-modal .pagefind-ui__button {
  display: none !important;
}

/* Hide search results count and stats */
.search-modal .pagefind-ui__stats,
.search-modal .pagefind-ui__results-area > p,
.search-modal .pagefind-ui__message {
  display: none !important;
}

@media (max-width: 768px) {
  .search-modal {
    padding: 15px;
  }
  
  .search-modal-content {
    margin: 30px auto;
    padding: 24px;
  }
  
  .search-modal h3 {
    font-size: 1.5rem;
  }
}
</style>