{{/* Search Modal Overlay */}}
<div id="search-modal" class="search-modal" style="display:none;position:fixed;top:0;left:0;width:100%;height:100%;background:rgba(0,0,0,0.6);z-index:9999;padding:20px;box-sizing:border-box;">
  <div class="search-modal-content" style="max-width:800px;margin:50px auto;background:#fff;border-radius:12px;padding:24px;box-shadow:0 8px 32px rgba(0,0,0,0.3);position:relative;">
    <button id="search-modal-close" style="position:absolute;top:16px;right:16px;background:none;border:none;font-size:24px;cursor:pointer;color:#666;width:32px;height:32px;display:flex;align-items:center;justify-content:center;border-radius:6px;transition:background 0.2s;" onmouseover="this.style.background='#f0f0f0'" onmouseout="this.style.background='none'">×</button>
    
    <h3 style="margin-top:0;margin-bottom:20px;font-size:1.5rem;color:#333;">{{ i18n "search" | default "검색" }}</h3>
    
    <div id="search-container">
      <input 
        id="search-modal-input" 
        type="search" 
        placeholder="{{ i18n "search_placeholder" | default "검색어를 입력하세요..." }}" 
        style="width:100%;padding:12px 16px;border:2px solid #e1e5e9;border-radius:8px;font-size:16px;outline:none;transition:border-color 0.2s;"
        onfocus="this.style.borderColor='#007bff'"
        onblur="this.style.borderColor='#e1e5e9'"
      >
      <div id="search-modal-results" style="margin-top:16px;max-height:400px;overflow-y:auto;"></div>
    </div>
  </div>
</div>

<script>
(function(){
  let searchModal = null;
  let searchInput = null;
  let searchResults = null;
  let pagefindUI = null;
  
  function initSearchModal() {
    searchModal = document.getElementById('search-modal');
    searchInput = document.getElementById('search-modal-input');
    searchResults = document.getElementById('search-modal-results');
    
    if (!searchModal) return;
    
    // Close modal handlers
    document.getElementById('search-modal-close').addEventListener('click', closeModal);
    searchModal.addEventListener('click', function(e) {
      if (e.target === searchModal) closeModal();
    });
    
    // ESC key to close
    document.addEventListener('keydown', function(e) {
      if (e.key === 'Escape' && searchModal.style.display !== 'none') {
        closeModal();
      }
    });
    
    // Focus search input when modal opens
    searchInput.addEventListener('focus', function() {
      if (!pagefindUI) {
        loadPagefindUI();
      }
    });
    
    // Search icon click handler
    document.addEventListener('click', function(e) {
      const searchBtn = e.target.closest('[data-search-toggle], .search-btn, .navbar-nav .nav-link[href*="search"]');
      if (searchBtn) {
        e.preventDefault();
        openModal();
      }
    });
  }
  
  function openModal() {
    if (searchModal) {
      searchModal.style.display = 'block';
      document.body.style.overflow = 'hidden';
      setTimeout(() => searchInput.focus(), 100);
    }
  }
  
  function closeModal() {
    if (searchModal) {
      searchModal.style.display = 'none';
      document.body.style.overflow = '';
      searchInput.value = '';
      searchResults.innerHTML = '';
    }
  }
  
  function loadPagefindUI() {
    if (pagefindUI) return;
    
    const script = document.createElement('script');
    script.src = '/pagefind/pagefind-ui.js';
    script.onload = function() {
      if (window.PagefindUI) {
        pagefindUI = new window.PagefindUI({
          element: '#search-modal-results',
          showSubResults: false,
          showImages: false,
          excerptLength: 30,
          autofocus: false,
          resetStyles: true,
          showEmptyFilters: false,
          translations: {
            placeholder: '{{ i18n "search_placeholder" | default "검색어를 입력하세요..." }}'
          }
        });
        
        // Sync external input with Pagefind UI
        searchInput.addEventListener('input', function(e) {
          const query = e.target.value;
          const pagefindInput = searchResults.querySelector('input[type="search"]');
          if (pagefindInput) {
            pagefindInput.value = query;
            pagefindInput.dispatchEvent(new Event('input'));
          }
        });
      }
    };
    document.head.appendChild(script);
    
    const link = document.createElement('link');
    link.rel = 'stylesheet';
    link.href = '/pagefind/pagefind-ui.css';
    document.head.appendChild(link);
  }
  
  // Initialize when DOM is ready
  if (document.readyState === 'loading') {
    document.addEventListener('DOMContentLoaded', initSearchModal);
  } else {
    initSearchModal();
  }
})();
</script>

<style>
.search-modal input[type="search"]:focus {
  border-color: #007bff !important;
  box-shadow: 0 0 0 0.2rem rgba(0, 123, 255, 0.25);
}

.search-modal .pagefind-ui__search-input {
  display: none !important;
}

.search-modal .pagefind-ui__results {
  margin-top: 0 !important;
}

.search-modal .pagefind-ui__result {
  border: 1px solid #e9ecef;
  border-radius: 8px;
  margin-bottom: 12px;
  padding: 16px;
  transition: box-shadow 0.2s;
}

.search-modal .pagefind-ui__result:hover {
  box-shadow: 0 2px 8px rgba(0,0,0,0.1);
}

.search-modal .pagefind-ui__result-title {
  font-weight: 600;
  color: #007bff;
  margin-bottom: 8px;
}

.search-modal .pagefind-ui__result-excerpt {
  color: #666;
  line-height: 1.5;
}

/* Hide any suggestion or autocomplete elements */
.search-modal .pagefind-ui__drawer,
.search-modal .pagefind-ui__suggestions,
.search-modal .pagefind-ui__filter-panel {
  display: none !important;
}

/* Hide filters and other UI elements */
.search-modal .pagefind-ui__filters,
.search-modal .pagefind-ui__sort-select,
.search-modal .pagefind-ui__button {
  display: none !important;
}

/* Hide search results count and stats */
.search-modal .pagefind-ui__stats,
.search-modal .pagefind-ui__results-area > p,
.search-modal .pagefind-ui__message {
  display: none !important;
}

@media (max-width: 768px) {
  .search-modal {
    padding: 10px;
  }
  
  .search-modal-content {
    margin: 20px auto;
    padding: 20px;
  }
}
</style>