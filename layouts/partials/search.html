<div id="search-modal" style="display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0, 0, 0, 0.8); z-index: 9999; padding: 20px; overflow-y: auto;">
  <div id="search-container" style="max-width: 800px; margin: 50px auto; background: white; border-radius: 12px; padding: 20px; box-shadow: 0 4px 20px rgba(0, 0, 0, 0.3);">
    <button id="search-close" style="position: absolute; top: 10px; right: 20px; font-size: 40px; border: none; background: none; cursor: pointer; color: #666;">×</button>
    <div id="pagefind-ui"></div>
  </div>
</div>

<script>
document.addEventListener('DOMContentLoaded', function() {
  const searchModal = document.getElementById('search-modal');
  const searchContainer = document.getElementById('search-container');
  const closeBtn = document.getElementById('search-close');
  
  // Dark mode styling
  function updateSearchModalTheme() {
    const isDarkMode = document.body.getAttribute('data-mode') === 'dark';
    if (isDarkMode) {
      searchContainer.style.background = '#1e1e1e';
      searchContainer.style.color = '#ffffff';
      closeBtn.style.color = '#ffffff';
    } else {
      searchContainer.style.background = 'white';
      searchContainer.style.color = '#333';
      closeBtn.style.color = '#666';
    }
  }
  
  // Load Pagefind UI
  function loadPagefind() {
    if (window.pagefindLoaded) return;
    
    const link = document.createElement('link');
    link.rel = 'stylesheet';
    link.href = '/pagefind/pagefind-ui.css';
    document.head.appendChild(link);
    
    const script = document.createElement('script');
    script.src = '/pagefind/pagefind-ui.js';
    script.onload = () => {
      new PagefindUI({
        element: '#pagefind-ui',
        showSubResults: true,
        showImages: false,
        excerptLength: 30,
        resetStyles: false,
        translations: {
          placeholder: "인숙영, 전북대학교, SookYoung In, JBNU 검색...",
          clear_search: "검색 초기화",
          load_more: "더 보기",
          search_label: "사이트 검색",
          filters_label: "필터",
          zero_results: "검색 결과가 없습니다: [SEARCH_TERM]",
          many_results: "[COUNT]개의 결과를 찾았습니다: [SEARCH_TERM]",
          one_result: "1개의 결과를 찾았습니다: [SEARCH_TERM]",
          alt_search: "[SEARCH_TERM]에 대한 검색 결과",
          search_suggestion: "다른 검색어를 시도해보세요",
          searching: "검색 중..."
        }
      });
      window.pagefindLoaded = true;
    };
    document.head.appendChild(script);
  }
  
  // Open search modal
  function openSearch() {
    loadPagefind();
    searchModal.style.display = 'block';
    updateSearchModalTheme();
    setTimeout(() => {
      const searchInput = document.querySelector('#pagefind-ui input');
      if (searchInput) searchInput.focus();
    }, 100);
  }
  
  // Close modal
  closeBtn.onclick = () => searchModal.style.display = 'none';
  
  // Close on outside click
  searchModal.addEventListener('click', function(e) {
    if (e.target === searchModal) {
      searchModal.style.display = 'none';
    }
  });
  
  // Detect all search button clicks (돋보기 아이콘 포함)
  document.addEventListener('click', function(e) {
    // Check if clicked element or its parent is a search-related button
    const target = e.target;
    const parent = target.closest('a, button');
    
    // Search for magnifying glass icon, search buttons, etc.
    if (
      target.matches('[aria-label*="search" i], [title*="search" i], .search-btn, .btn-search, [data-search]') ||
      parent?.matches('[aria-label*="search" i], [title*="search" i], .search-btn, .btn-search, [data-search]') ||
      target.classList.contains('fa-search') ||
      target.classList.contains('fa-magnifying-glass') ||
      parent?.querySelector('.fa-search, .fa-magnifying-glass')
    ) {
      e.preventDefault();
      openSearch();
    }
  });
  
  // Keyboard shortcut (Ctrl/Cmd + K)
  document.addEventListener('keydown', function(e) {
    if ((e.ctrlKey || e.metaKey) && e.key === 'k') {
      e.preventDefault();
      openSearch();
    }
    
    // ESC to close
    if (e.key === 'Escape') {
      searchModal.style.display = 'none';
    }
  });
  
  // Update theme when mode changes
  const observer = new MutationObserver(updateSearchModalTheme);
  observer.observe(document.body, { attributes: true, attributeFilter: ['data-mode'] });
  
  // Listen for FAB search button
  document.addEventListener('openPagefindSearch', function() {
    openSearch();
  });
});
</script>

<style>
#pagefind-ui {
  font-family: inherit;
}

#pagefind-ui .pagefind-ui__search-input {
  width: 100%;
  padding: 12px 20px;
  font-size: 16px;
  border: 2px solid #7c4dff;
  border-radius: 8px;
  margin-bottom: 20px;
}

#pagefind-ui .pagefind-ui__result {
  padding: 15px;
  margin-bottom: 10px;
  border: 1px solid #e0e0e0;
  border-radius: 8px;
  transition: all 0.3s ease;
}

#pagefind-ui .pagefind-ui__result:hover {
  border-color: #7c4dff;
  box-shadow: 0 2px 8px rgba(124, 77, 255, 0.2);
}

#pagefind-ui .pagefind-ui__result-title {
  font-size: 18px;
  font-weight: 600;
  color: #7c4dff;
  margin-bottom: 8px;
}

#pagefind-ui .pagefind-ui__result-excerpt {
  color: #666;
  line-height: 1.5;
}

/* Dark mode styles */
[data-mode="dark"] #pagefind-ui .pagefind-ui__search-input {
  background: #2a2a2a;
  color: #ffffff;
  border-color: #bb86fc;
}

[data-mode="dark"] #pagefind-ui .pagefind-ui__result {
  background: #2a2a2a;
  border-color: #444;
}

[data-mode="dark"] #pagefind-ui .pagefind-ui__result:hover {
  border-color: #bb86fc;
}

[data-mode="dark"] #pagefind-ui .pagefind-ui__result-title {
  color: #bb86fc;
}

[data-mode="dark"] #pagefind-ui .pagefind-ui__result-excerpt {
  color: #e0e0e0;
}

/* Responsive design */
@media (max-width: 768px) {
  #search-modal {
    padding: 10px;
  }

  #search-container {
    margin: 20px auto;
    padding: 15px;
  }

  #pagefind-ui .pagefind-ui__search-input {
    font-size: 14px;
    padding: 10px 16px;
  }

  #pagefind-ui .pagefind-ui__result-title {
    font-size: 16px;
  }
}
</style>

