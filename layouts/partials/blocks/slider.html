{{/*
  Simplified Slider Block Partial - Force Korean content for Korean pages
*/}}

{{ $currentPath := .Page.RelPermalink | default "/" }}
{{ $lang := .Page.Language.Lang | default "ko" }}
{{ $isEnglishPage := or (hasPrefix $currentPath "/en/") (eq $lang "en") }}
{{ $isKoreanPage := not $isEnglishPage }}

{{ $slides := slice }}
{{ if $isKoreanPage }}
  {{ $slides = (slice
    (dict "title" "React · TypeScript" "content" "컴포넌트 설계와 상태 관리로 유지보수성 높은 UI를 구현" "background" (dict "image" (dict "filename" "/uploads/1_unsplash.jpg")))
    (dict "title" "실습을 통한 학습" "content" "작게 만들고 빠르게 개선하며 결과로 증명" "background" (dict "image" (dict "filename" "/uploads/2_unsplash.jpg")))
    (dict "title" "알고리즘" "content" "복잡도 분석을 바탕으로 효율적인 로직과 최적화" "background" (dict "image" (dict "filename" "/uploads/3_unsplash.jpg")))
  ) }}
{{ else }}
  {{ $slides = (slice
    (dict "title" "React · TypeScript" "content" "Maintainable UIs through component design and state management" "background" (dict "image" (dict "filename" "/uploads/1_unsplash.jpg")))
    (dict "title" "Learning by Building" "content" "Start small, iterate fast, and prove with results" "background" (dict "image" (dict "filename" "/uploads/2_unsplash.jpg")))
    (dict "title" "Algorithms" "content" "Efficiency via complexity analysis and focused optimizations" "background" (dict "image" (dict "filename" "/uploads/3_unsplash.jpg")))
  ) }}
{{ end }}

{{ $block := or .block (or .Block (or .section (or .Section .))) }}
{{ $heightCss := "420px" }}
{{ $heightNum := 420 }}
{{ $interval := 3500 }}
{{ $autoplay := true }}
{{ $fullscreen := false }}

{{ if isset $block "design" }}
  {{ with $block.design.slide_height }}
    {{ $h := printf "%v" . }}
    {{ if gt (len (findRE "^[0-9]+$" $h)) 0 }}
      {{ $heightCss = printf "%spx" $h }}
      {{ $heightNum = (int $h) }}
    {{ else }}
      {{ $heightCss = $h }}
      {{ $heightNum = (int (replaceRE "[^0-9]" "" $h)) }}
    {{ end }}
  {{ end }}
  {{ with $block.design.interval }}{{ $interval = . }}{{ end }}
  {{ with $block.design.loop }}{{ $autoplay = . }}{{ end }}
  {{ with $block.design.is_fullscreen }}{{ $fullscreen = . }}{{ end }}
{{ end }}

<div class="cc-slider" data-autoplay="{{ $autoplay }}" data-interval="{{ $interval }}" data-height="{{ $heightNum }}" data-fullscreen="{{ $fullscreen }}" style="position:relative;min-height:{{ $heightCss }};">
  <div class="cc-slider__track" style="display:flex;gap:12px;overflow-x:auto;white-space:nowrap;padding:8px;scroll-snap-type:x mandatory;scrollbar-width:none;">
    {{ range $slides }}
      {{ $title := .title }}
      {{ $desc := or .content .subtitle }}
      {{ $fn := "" }}
      {{ with .background }}
        {{ with .image }}
          {{ if .filename }}
            {{ $fn = .filename }}
          {{ else }}
            {{ $fn = printf "%v" . }}
          {{ end }}
        {{ end }}
      {{ end }}
      {{ if eq $fn "" }}
        {{ with .image }}
          {{ if .filename }}
            {{ $fn = .filename }}
          {{ else }}
            {{ $fn = printf "%v" . }}
          {{ end }}
        {{ end }}
      {{ end }}
      {{ if eq $fn "" }}{{ with .media }}{{ $fn = . }}{{ end }}{{ end }}

      <figure style="min-width:90%;margin:0;position:relative;scroll-snap-align:start;border-radius:12px;overflow:hidden;">
        {{ $url := "" }}
        {{ if $fn }}
          {{ if hasPrefix $fn "/" }}
            {{ $url = $fn }}
          {{ else }}
            {{ with (resources.Get (printf "media/%s" $fn)) }}
              {{ $url = .RelPermalink }}
            {{ else }}
              {{ if (fileExists (printf "static/uploads/%s" $fn)) }}
                {{ $url = (printf "/uploads/%s" $fn) }}
              {{ end }}
            {{ end }}
          {{ end }}
        {{ end }}

        {{ if $url }}
          <img src="{{ $url }}" alt="{{ $title }}" style="width:100%;height:{{ $heightCss }};object-fit:cover;display:block;" loading="lazy" />
        {{ else }}
          <div style="width:100%;height:{{ $heightCss }};background:linear-gradient(135deg,#7C4DFF,#651FFF);"></div>
        {{ end }}

        <!-- Enhanced overlay with transparency layer -->
        <div style="position:absolute;top:0;left:0;right:0;bottom:0;background:linear-gradient(135deg, rgba(124,77,255,0.3) 0%, rgba(101,31,255,0.4) 50%, rgba(0,0,0,0.2) 100%);"></div>
        
        <figcaption style="position:absolute;left:0;right:0;bottom:0;color:#fff;background:linear-gradient(transparent 0%, rgba(0,0,0,0.4) 30%, rgba(0,0,0,0.8) 100%);padding:20px 24px;z-index:2;">
          {{ with $title }}<div style="font-weight:700;font-size:1.2rem;line-height:1.3;text-shadow:2px 2px 4px rgba(0,0,0,0.8);margin-bottom:8px;">{{ . }}</div>{{ end }}
          {{ with $desc }}<div style="opacity:0.95;font-size:1rem;text-shadow:1px 1px 3px rgba(0,0,0,0.7);">{{ . }}</div>{{ end }}
        </figcaption>
      </figure>
    {{ end }}
  </div>
  <div class="cc-slider__dots" style="display:flex;gap:8px;justify-content:center;margin:8px 0 0 0;"></div>
</div>

<style>
  .cc-slider__track::-webkit-scrollbar { display:none; }
  .cc-slider__dot { width:28px;height:4px;border-radius:2px;background:#c7c7c7;opacity:.6;transition:opacity .2s,background-color .2s }
  .cc-slider__dot[aria-current="true"] { background: var(--bs-primary, #7C4DFF); opacity:1 }
  @media (max-width: 768px){ .cc-slider figure{ min-width: 92%; } }
</style>
<script>
  (function(){
    function init(el){
      if (el.dataset.enhanced) return; el.dataset.enhanced = '1';
      const track = el.querySelector('.cc-slider__track');
      const figs = Array.from(track.querySelectorAll('figure'));
      const dotsWrap = el.querySelector('.cc-slider__dots');
      
      if (!figs.length) return;
      
      dotsWrap.innerHTML = '';
      figs.forEach((_,i)=>{
        const dot = document.createElement('button');
        dot.type = 'button';
        dot.className = 'cc-slider__dot';
        dot.setAttribute('aria-label','Go to slide '+(i+1));
        dot.addEventListener('click',()=>{
          const target = figs[i];
          track.scrollTo({ left: target.offsetLeft - track.offsetLeft, behavior:'smooth' });
        });
        dotsWrap.appendChild(dot);
      });
      
      const setActive = ()=>{
        const idx = Math.round(track.scrollLeft / (track.scrollWidth / figs.length));
        Array.from(dotsWrap.children).forEach((d,j)=>d.setAttribute('aria-current', j===idx ? 'true':'false'));
      };
      track.addEventListener('scroll', ()=>{ window.requestAnimationFrame(setActive); });
      setActive();
      
      if (el.dataset.autoplay === 'true'){
        let i=0; let timer;
        const interval = parseInt(el.dataset.interval||'3500',10);
        const play=()=>{ timer = setInterval(()=>{
          i = (i+1)%figs.length;
          const t = figs[i];
          track.scrollTo({ left: t.offsetLeft - track.offsetLeft, behavior:'smooth' });
        }, interval); };
        const pause=()=>{ if (timer) clearInterval(timer); };
        el.addEventListener('mouseenter', pause);
        el.addEventListener('mouseleave', ()=>{ play(); });
        play();
      }
    }
    function onReady(){ document.querySelectorAll('.cc-slider').forEach(init); }
    if (document.readyState === 'loading') document.addEventListener('DOMContentLoaded', onReady); else onReady();
  })();
</script>